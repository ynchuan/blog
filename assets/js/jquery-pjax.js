!new function(window,document,undefined,$){"use strict";var MODULE;!function(e){var t;!function(e){e.NAME="pjax",e.NAMESPACE=jQuery}(t=e.DEF||(e.DEF={}))}(MODULE||(MODULE={}));var MODULE;!function(e){!function(e){e[e.blank=0]="blank",e[e.initiate=1]="initiate",e[e.open=2]="open",e[e.pause=3]="pause",e[e.lock=4]="lock",e[e.seal=5]="seal",e[e.error=6]="error",e[e.crash=7]="crash",e[e.terminate=8]="terminate",e[e.close=9]="close"}(e.State||(e.State={}));e.State;e.EVENT={PJAX:e.DEF.NAME.toLowerCase(),CLICK:"click",SUBMIT:"submit",POPSTATE:"popstate",SCROLL:"scroll"}}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){function t(e,t){var r=e.prototype;t=t.reverse();for(var i=t.length;i--;){var n=t[i].prototype;for(var o in n)"constructor"!==o&&r[o]&&n.hasOwnProperty(o)&&(r[o]=n[o])}}function r(){function e(e){var t=16*Math.random()|0,r="x"==e?t:3&t|8;return r.toString(16).toUpperCase()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e)}function i(e,t){if(!Object.freeze||e===e.window||"ownerDocument"in e)return e;if(!Object.isFrozen(e)&&Object.freeze(e),!t)return e;for(var r in e){var n=e[r];~"object,function".indexOf(typeof n)&&n&&i(n,t)}return e}function n(e,t){if(!Object.seal||e===e.window||"ownerDocument"in e)return e;if(!Object.isSealed(e)&&Object.seal(e),!t)return e;for(var r in e){var i=e[r];~"object,function".indexOf(typeof i)&&i&&n(i,t)}return e}e.MIXIN=t,e.UUID=r,e.FREEZE=i,e.SEAL=n}(MODULE||(MODULE={}));var MODULE;!function(e){}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(){function t(t){this.NAME=e.DEF.NAME,this.NAMESPACE=e.DEF.NAMESPACE,this.UUID=e.UUID(),this.state_=e.State.blank,this.state_=t}return t.prototype.MAIN=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.main_.apply(this,[e].concat(t))},t.prototype.main_=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e},t}();t.Template=r}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(){function t(t){this.UUID=e.UUID(),this.state_=e.State.blank,this.state_=t}return t}();t.Template=r}(t=e.VIEW||(e.VIEW={}))}(MODULE||(MODULE={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},MODULE;!function(e){var t;!function(t){var r=function(t){function r(r,i,n,o){var a=this;t.call(this,e.State.initiate),this.model_=r,this.controller_=i,this.context_=n,this.handlers={click:function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];a.controller_.click(e)},submit:function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];a.controller_.submit(e)},popstate:function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];a.controller_.popstate(e)},scroll:function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];a.controller_.scroll(e)}},e.FREEZE(this),this.observe_(o)}return __extends(r,t),r.prototype.observe_=function(e){return this.release_(e),e.link&&this.context_.delegate(e.link,e.nss.event.click,this.handlers.click),e.form&&this.context_.delegate(e.form,e.nss.event.submit,this.handlers.submit),jQuery(window).bind(e.nss.event.popstate,this.handlers.popstate),e.database.active&&e.fix.scroll&&jQuery(window).bind(e.nss.event.scroll,this.handlers.scroll),this},r.prototype.release_=function(e){return e.link&&this.context_.undelegate(e.link,e.nss.event.click),e.form&&this.context_.undelegate(e.form,e.nss.event.submit),jQuery(window).unbind(e.nss.event.popstate),e.database.active&&e.fix.scroll&&jQuery(window).unbind(e.nss.event.scroll),this},r}(t.Template);t.Main=r}(t=e.VIEW||(e.VIEW={}))}(MODULE||(MODULE={}));var MODULE;!function(e){e.View=e.VIEW.Main}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(){function t(){e.FREEZE(this)}return t.prototype.enable=function(){return e.Model.singleton().enable(),this},t.prototype.disable=function(){return e.Model.singleton().disable(),this},t.prototype.click=function(t,r){var i;switch(typeof t){case"undefined":i=jQuery(this).filter("a").first().clone();break;case"object":i=jQuery(t).clone();break;case"string":r=jQuery.extend(!0,{},r,{href:t}),i=jQuery("<a/>",r);break;default:return this}var n=e.Model.singleton().configure(i[0]);return n&&i.first().one(n.nss.event.click,function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];return e.Controller.singleton().click(t)}).click(),this},t.prototype.submit=function(t,r,i){var n,o,a,s=document.createDocumentFragment();switch(typeof t){case"undefined":n=jQuery(this).filter("form").first().clone();break;case"object":n=jQuery(t).clone();break;case"string":r=jQuery.extend(!0,{},r,{action:t}),o=i instanceof Array&&Array||i instanceof Object&&Object||undefined;for(var c in i){switch(o){case Object:if(!Object.prototype.hasOwnProperty.call(i,c))continue;a=jQuery("<textarea/>",{name:c}).val(i[c]);break;case Array:i[c].attrs=i[c].attrs||{},i[c].attrs.name=i[c].name||i[c].attrs.name,i[c].attrs.type=i[c].type||i[c].attrs.type,a=jQuery("<"+i[c].tag+"/>",i[c].attrs).val(i[c].value);break;default:continue}s.appendChild(a[0])}n=jQuery("<form/>",r).append(s);break;default:return this}var u=e.Model.singleton().configure(n[0]);return u&&n.first().one(u.nss.event.submit,function(){for(var t=[],r=0;r<arguments.length;r++)t[r-0]=arguments[r];return e.Controller.singleton().submit(t)}).submit(),this},t.prototype.getCache=function(t){void 0===t&&(t=window.location.href);var r=e.Model.singleton().getCache(t);return r&&(r={data:r.data,textStatus:r.textStatus,jqXHR:r.jqXHR,expires:r.expires}),r},t.prototype.setCache=function(t,r,i,n){switch(void 0===t&&(t=window.location.href),arguments.length){case 0:return this.setCache(t,document.documentElement.outerHTML);case 1:return this.setCache(t,null);case 2:case 3:case 4:default:e.Model.singleton().setCache(t,r,i,n)}return this},t.prototype.removeCache=function(t){return void 0===t&&(t=window.location.href),e.Model.singleton().removeCache(t),this},t.prototype.clearCache=function(){return e.Model.singleton().clearCache(),this},t.prototype.follow=function(t,r,i,n){if(!e.Model.singleton().isDeferrable)return!1;var o=t.currentTarget;return r.follow=!0,r.host=i||"",isFinite(t.timeStamp)&&(r.timeStamp=n||t.timeStamp),e.Model.singleton().setPageXHR(r),jQuery.when(r).done(function(){!e.Model.singleton().getCache(o.href)&&e.Model.singleton().isOperatable(t)&&e.Model.singleton().setCache(o.href,undefined,undefined,r)}),jQuery[e.DEF.NAME].click(o.href),!0},t.prototype.bypass=function(){return e.Model.singleton().bypass()},t.prototype.host=function(){return e.Model.singleton().host()},t}();t.Functions=r}(t=e.CONTROLLER||(e.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(){function t(){e.FREEZE(this)}return t}();t.Methods=r}(t=e.CONTROLLER||(e.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(){function t(t,r){this.UUID=e.UUID(),this.state_=e.State.blank,this.PROPERTIES=[],this.state_=r}return t.prototype.EXTEND=function(t){return t instanceof e.DEF.NAMESPACE?(t instanceof jQuery&&(t=t.add()),this.REGISTER_FUNCTION(t),this.REGISTER_METHOD(t)):(t!==this.EXTENSION&&(t=this.EXTENSION),this.REGISTER_FUNCTION(t)),this.UPDATE_PROPERTIES(t),t},t.prototype.REGISTER=function(t){var r=this;this.EXTENSION=this.EXTENSION||function(){for(var e=[],i=0;i<arguments.length;i++)e[i-0]=arguments[i];var n=r.EXTEND(this);return e=[n].concat(e),e=r.EXEC.apply(r,e),e instanceof Array?t.MAIN.apply(t,e):e},this.EXTEND(this.EXTENSION),window[e.DEF.NAMESPACE]=window[e.DEF.NAMESPACE]||{},e.DEF.NAMESPACE.prototype?e.DEF.NAMESPACE[e.DEF.NAME]=e.DEF.NAMESPACE.prototype[e.DEF.NAME]=this.EXTENSION:e.DEF.NAMESPACE[e.DEF.NAME]=this.EXTENSION},t.prototype.EXEC=function(){return this.exec_.apply(this,arguments)},t.prototype.exec_=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return[e].concat(t)},t.prototype.REGISTER_FUNCTION=function(e){var t=this.FUNCTIONS;for(var r in t)"constructor"!==r&&(e[r]=t[r]);return e},t.prototype.REGISTER_METHOD=function(e){var t=this.METHODS;for(var r in t)"constructor"!==r&&(e[r]=t[r]);return e},t.prototype.UPDATE_PROPERTIES=function(e){var t,r,i,n=this.PROPERTIES;for(t=0,r=n.length;r>t;t++)"constructor"!==t&&(i=n[t],e[i]&&(e[i]=e[i]()));return e},t}();t.Template=r}(t=e.CONTROLLER||(e.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(r){function i(i){r.call(this,i,e.State.initiate),this.model_=i,this.FUNCTIONS=new t.Functions,this.METHODS=new t.Methods,this.REGISTER(i),e.FREEZE(this)}return __extends(i,r),i.prototype.exec_=function(e){var t=[].slice.call(arguments,1,2),r=t[0];switch(typeof r){case"undefined":case"object":break;default:return e}return[e].concat(t)},i.prototype.view=function(t,r){return new e.View(this.model_,this,t,r)},i.prototype.click=function(e){this.model_.click.apply(this.model_,e)},i.prototype.submit=function(e){this.model_.submit.apply(this.model_,e)},i.prototype.popstate=function(e){this.model_.popstate.apply(this.model_,e)},i.prototype.scroll=function(e){this.model_.scroll.apply(this.model_,e)},i}(t.Template);t.Main=r;var i=function(){function t(i){void 0===i&&(i=e.Model.singleton()),t.instance_=t.instance_||new r(i)}return t.singleton=function(){return t.instance_},t.prototype.singleton=function(){return t.singleton()},t}();t.Singleton=i}(t=e.CONTROLLER||(e.CONTROLLER={}))}(MODULE||(MODULE={}));var MODULE;!function(e){e.Controller=e.CONTROLLER.Singleton}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t=function(){function e(e,t){void 0===e&&(e=1),void 0===t&&(t=0),this.list_=[],this.config_={mode:1,size:0},this.table_={},this.option_={},this.config_.mode=e||this.config_.mode,this.config_.size=t||this.config_.size}return e.prototype.define=function(e,t,r){void 0===t&&(t=this.config_.mode),void 0===r&&(r=this.config_.size),this.option_[e]={mode:t,size:r},this.table_[e]=[]},e.prototype.reserve=function(e,t){switch(typeof e){case"string":!this.option_[e]&&this.define(e);var r=this.option_[e],i=this.table_[e],n=[].slice.call(arguments,2);break;case"function":t=e,e=undefined;var r=this.config_,i=this.list_,n=[].slice.call(arguments,1);break;default:return}if("function"==typeof t){var o;o=r.mode>0?"push":"unshift",i[o]([t,n.shift(),n])}},e.prototype.digest=function(e,t){switch(typeof e){case"string":!this.option_[e]&&this.define(e),t=t||0;var r=this.option_[e],i=this.table_[e];if(!i)return;break;case"number":case"undefined":t=e||0,e=undefined;var r=this.config_,i=this.list_;break;default:return}i.length>r.size&&r.size&&(r.mode>0?i.splice(0,i.length-r.size):i.splice(i.length-r.size,i.length));var n;for(t=t||-1;n=t--&&i.pop();)n.shift().apply(n.shift()||window,n.shift()||[]);if(undefined===e){var o=this.table_;for(var a in o)this.digest(a,t)}},e.prototype.clear=function(e){switch(typeof e){case"string":!this.option_[e]&&this.define(e),this.table_[e].splice(0,this.table_[e].length);break;default:var t=this.table_;for(var r in t)this.clear(r)}},e}();e.Task=t}(t=e.LIBRARY||(e.LIBRARY={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.task_=e,this.labels_={done:"done",fail:"fail",always:"always"}}return e.prototype.done=function(e){return this.task_.reserve(this.labels_.done,e),this},e.prototype.fail=function(e){return this.task_.reserve(this.labels_.fail,e),this},e.prototype.always=function(e){return this.task_.reserve(this.labels_.always,e),this},e.prototype.resolve=function(){return this.task_.clear(this.labels_.fail),this.task_.digest(this.labels_.done),this.task_.digest(this.labels_.always),this},e.prototype.reject=function(){return this.task_.clear(this.labels_.done),this.task_.digest(this.labels_.fail),this.task_.digest(this.labels_.always),this},e}();e.Task=t;var r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.TaskUp=r;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.done=function(e){return this},t.prototype.fail=function(e){return this},t.prototype.always=function(e){return this},t.prototype.resolve=function(){return this},t}(t);e.TaskDown=i}(t=e.STATEFUL||(e.STATEFUL={}))}(t=e.DB||(e.DB={}))}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){var r;!function(t){var r=function(){function r(t,r,i){var n=this;this.origin_=t,this.connect_=r,this.extend_=i,this.state_=function(){return n.origin_.state()},this.task_=new e.LIBRARY.Task,this.cache_={stateful:{}}}return r.prototype.stateful_=function(){var r=this,i=function(e,t){return r.cache_.stateful[r.state_()]=r.cache_.stateful[r.state_()]||new e(r.origin_,r.connect_,r.extend_,r.task_,t)};switch(this.state_()){case e.State.blank:return i(t.STATE.Blank,!0);case e.State.initiate:return i(t.STATE.Initiate,!0);case e.State.open:return i(t.STATE.Open,!0);case e.State.close:return i(t.STATE.Close,!0);case e.State.terminate:return i(t.STATE.Terminate,!0);case e.State.error:return i(t.STATE.Error,!1);default:return i(t.STATE.Except,!1)}},r.prototype.open=function(){return this.stateful_().open()},r.prototype.resolve=function(){return this.stateful_().resolve()},r.prototype.reject=function(){return this.stateful_().reject()},r}();t.Stateful=r}(r=t.DB||(t.DB={}))}(r=t.DATA||(t.DATA={}))}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(t,r,i,n,o){this.origin=t,this.connect=r,this.extend=i,this.task=o?new e.STATEFUL.TaskUp(n):new e.STATEFUL.TaskDown(n)}return t.prototype.open=function(){return this.task},t.prototype.resolve=function(){},t.prototype.reject=function(){this.task.reject()},t}();t.Default=r;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.open=function(){return this.connect(),this.task},t.prototype.resolve=function(){this.open()},t.prototype.reject=function(){this.task.reject()},t}(r);t.Blank=i;var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.open=function(){return this.task},t.prototype.resolve=function(){},t.prototype.reject=function(){this.task.reject()},t}(r);t.Initiate=n;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.open=function(){var e=this;return this.extend(),setTimeout(function(){return e.origin.resolve()},1),this.task},t.prototype.resolve=function(){this.task.resolve()},t.prototype.reject=function(){this.task.reject()},t}(r);t.Open=o;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.open=function(){return this.connect(),this.task},t.prototype.resolve=function(){this.open()},t.prototype.reject=function(){this.task.reject()},t}(r);t.Close=a;var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r);t.Terminate=s;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r);t.Error=c;var u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(r);t.Except=u}(t=e.STATE||(e.STATE={}))}(t=e.DB||(e.DB={}))}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.DB=e,this.autoIncrement=!1,this.indexes=[],this.size=100,this.buffer={},this.diff={}}return e.prototype.accessStore=function(e,t){var r=this;void 0===t&&(t="readwrite");try{var i=this.DB.database(),n=i&&i.transaction(this.name,t).objectStore(this.name)}catch(o){}n?e(n):this.DB.open().done(function(){return r.accessStore(e)})},e.prototype.accessCount=function(){var e="string"==typeof arguments[0]&&arguments[0],t=arguments[e?1:0];this.accessStore(function(r){var i=e?r.index(e).count():r.count();i.onsuccess=function(){t.apply(this,[].slice.call(arguments,1).concat(this.result))}})},e.prototype.accessRecord=function(e,t,r){this.accessStore(function(r){r.get(e).onsuccess=t},r)},e.prototype.accessCursor=function(e,t,r,i){this.accessStore(function(n){var o;o=r&&t?n.index(e).openCursor(t,r):t?n.index(e).openCursor(t):n.openCursor(),o.onsuccess=i})},e.prototype.accessAll=function(e,t,r,i){"function"==typeof e&&(i=e,e=null,t=null,r=null),this.accessCursor(e,t,r,i)},e.prototype.get=function(e,t){var r=this;this.accessRecord(e,function(e){r.setBuffer(e.target.result),t(e)})},e.prototype.set=function(e,t){var r=this;e=jQuery.extend(!0,{},e),this.setBuffer(e,t),this.accessRecord(e[this.keyPath],function(i){i.target.source.put(t?jQuery.extend(!0,{},i.target.result,e):e),r.autoIncrement||delete r.diff[e[r.keyPath]]})},e.prototype.remove=function(e){this.removeBuffer(e),this.accessStore(function(t){t["delete"](e)})},e.prototype.clear=function(){this.clearBuffer(),this.accessStore(function(e){e.clear()})},e.prototype.clean=function(){var e=this;if(this.size&&this.indexes.length){var t=this.indexes[0].name,r=this.size;this.accessCount(t,function(i){r>=i||(r=i-r,e.accessCursor(t,e.DB.IDBKeyRange.upperBound(1/0),"next",function(t){if(t.target.result&&r--){var i=t.target.result;delete e.diff[i.primaryKey],i["delete"](),i["continue"]()}}))})}},e.prototype.loadBuffer=function(e){function t(){if(!this.result)return e&&e();var t=this.result;r[t.primaryKey]=t.value,t["continue"]()}if(!this.autoIncrement){var r=this.buffer;this.indexes.length?this.DB.IDBKeyRange&&this.accessAll(this.indexes[0].name,this.DB.IDBKeyRange.upperBound(1/0),"prev",t):this.accessAll(t)}},e.prototype.saveBuffer=function(e){var t=this;this.autoIncrement||this.accessStore(function(r){for(var i in t.diff)r.put(t.diff[i]);e&&e()})},e.prototype.getBuffers=function(){return this.buffer},e.prototype.setBuffers=function(e,t){for(var r in e)this.setBuffer(e[r],t);return this.buffer},e.prototype.getBuffer=function(e){return this.autoIncrement?void 0:this.buffer[e]},e.prototype.setBuffer=function(e,t){if(!this.autoIncrement){if(!e)return e;var r=e[this.keyPath];return this.buffer[r]=t?jQuery.extend(!0,{},this.buffer[r],e):e,this.diff[r]=this.buffer[r],this.buffer[r]}},e.prototype.removeBuffer=function(e){if(!this.autoIncrement){var t=this.buffer[e];return delete this.buffer[e],delete this.diff[e],t}},e.prototype.clearBuffer=function(){if(!this.autoIncrement){for(var e in this.buffer)delete this.buffer[e];for(var e in this.diff)delete this.diff[e]}},e}();e.Store=t}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.name="meta",this.keyPath="key",this.autoIncrement=!1,this.size=0}return __extends(t,e),t}(e.Store);t.Meta=r}(t=e.STORE||(e.STORE={}))}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.name="history",this.keyPath="url",this.autoIncrement=!1,this.indexes=[{name:"date",keyPath:"date",option:{unique:!1}}],this.size=300}return __extends(t,e),t}(e.Store);t.History=r}(t=e.STORE||(e.STORE={}))}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.name="server",this.keyPath="host",this.autoIncrement=!1,this.indexes=[{name:"score",keyPath:"score",option:{unique:!1}}],this.size=100}return __extends(t,e),t}(e.Store);t.Server=r}(t=e.STORE||(e.STORE={}))}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r;!function(t){var r=function(){function r(){var r=this;this.IDBFactory=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.msIDBKeyRange,this.name=e.DEF.NAME,this.version=10,this.refresh=10,this.upgrade=0,this.revision=0,this.state_=e.State.blank,this.stateful=new t.DB.Stateful(this,function(){return r.connect()},function(){return r.extend()}),this.age=1e4,this.expires=0,this.timer=0,this.stores={meta:new t.STORE.Meta(this),history:new t.STORE.History(this),server:new t.STORE.Server(this)},this.meta={version:{key:"version",value:undefined},update:{key:"update",value:undefined},revision:{key:"revision",value:undefined}}}return r.prototype.state=function(){return this.state_},r.prototype.extend=function(){var e=this;this.expires=(new Date).getTime()+this.age,clearTimeout(this.timer),this.timer=setTimeout(function(){return e.check()},this.age)},r.prototype.check=function(){!this.age||(new Date).getTime()<=this.expires||e.State.open===this.state()&&this.close()},r.prototype.database=function(){return this.extend(),this.database_},r.prototype.configure=function(e,t){this.revision=e,this.refresh=t},r.prototype.up=function(){this.state_=e.State.blank,this.open()},r.prototype.down=function(){this.reject(),this.close(),this.state_=e.State.error},r.prototype.open=function(){return!this.IDBFactory&&this.down(),this.stateful.open()},r.prototype.close=function(){this.database_&&this.database_.close&&this.database_.close(),this.state_=e.State.close},r.prototype.resolve=function(){this.stateful.resolve()},r.prototype.reject=function(){this.stateful.reject()},r.prototype.connect=function(){this.create()},r.prototype.create=function(){var t=this;try{this.close(),this.state_=e.State.initiate;var r=this.IDBFactory.open(this.name,this.upgrade?this.version:1),i=function(){t.verify(function(){t.state_=e.State.open,t.resolve(),t.extend()})};if("done"===r.readyState)this.database_=r.result,this.database()?i():this.format();else{var n=setTimeout(function(){return t.down()},3e3);r.onblocked=function(){clearTimeout(n),t.database_=r.result,t.close(),setTimeout(function(){return t.open()},1e3)},r.onupgradeneeded=function(){clearTimeout(n),t.database_=r.result,t.createStores()},r.onsuccess=function(){clearTimeout(n),t.database_=r.result,i()},r.onerror=function(){clearTimeout(n),t.database_=r.result,t.down()}}}catch(o){this.down()}},r.prototype.destroy=function(t,r){var i=this;try{this.close(),this.state_=e.State.terminate;var n=this.IDBFactory.deleteDatabase(this.name);n&&(n.onsuccess=t,n.onerror=r),setTimeout(function(){return e.State.terminate===i.state()&&i.down()},3e3)}catch(o){this.down()}},r.prototype.format=function(){var e=this;this.destroy(function(){return e.up()},function(){return e.down()})},r.prototype.verify=function(e){var t=this,r=this.database(),i=this.version,n=this.revision,o=this.meta,a=this.stores.meta,s=function(){return t.format()};if(r.objectStoreNames.length!==Object.keys(this.stores).length)return void s();for(var c in this.stores){var u=r.transaction(this.stores[c].name,"readonly").objectStore(this.stores[c].name);switch(!1){case u.keyPath===this.stores[c].keyPath:case u.indexNames.length===this.stores[c].indexes.length:return void s()}}var h=!1;a.get(o.version.key,function(e){if(!h){var r=e.target.result;!r||t.upgrade?a.set(a.setBuffer({key:o.version.key,value:i})):r.value>i?(h=!0,t.down()):r.value<i&&(h=!0,s())}}),a.get(o.revision.key,function(e){if(!h){var r=e.target.result;r?r.value>n?(h=!0,t.down()):r.value<n&&(h=!0,s()):a.set(a.setBuffer({key:o.revision.key,value:n}))}}),a.get(o.update.key,function(r){if(!h){var i=r.target.result,n=Math.floor((new Date).getTime()/864e5);i&&t.refresh?i.value>n?e():i.value<=n&&s():(a.set(a.setBuffer({key:o.update.key,value:n+t.refresh})),e())}})},r.prototype.createStores=function(){this.destroyStores();var e=this.database();for(var t in this.stores)for(var r,i=this.stores[t],n=e.createObjectStore(i.name,{keyPath:i.keyPath,autoIncrement:i.autoIncrement}),o=0,a=i.indexes;r=a[o];o++)n.createIndex(r.name,r.keyPath,r.option)},r.prototype.destroyStores=function(){for(var e=this.database(),t=e.objectStoreNames?e.objectStoreNames.length:0;t--;)e.deleteObjectStore(e.objectStoreNames[t])},r}();t.Database=r}(r=t.DATA||(t.DATA={}))}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.age_=e}return e.prototype.getCookie=function(e){if(e&&window.navigator.cookieEnabled){var t=new RegExp("(?:^|; )("+encodeURIComponent(e)+"=[^;]*)"),r=(document.cookie.match(t)||[]).pop();return r&&decodeURIComponent(r.split("=").pop())}},e.prototype.setCookie=function(e,t,r){return void 0===r&&(r={}),e&&window.navigator.cookieEnabled?(r.age=r.age||this.age_,document.cookie=[encodeURIComponent(e)+"="+encodeURIComponent(t),r.age?"; expires="+new Date((new Date).getTime()+1e3*r.age).toUTCString():"",r.path?"; path="+r.path:"; path=/",r.secure?"; secure":""].join(""),this.getCookie(e)):void 0},e}();e.Cookie=t}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){this.DB=new e.Database,this.Cookie=new e.Cookie(864e3)}return t}();e.Main=t}(t=e.DATA||(e.DATA={}))}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t=function(){function e(){}return e.trim=function(e){if(e="string"==typeof e?e:String(0===e&&e.toString()||""),e.trim)e=e.trim();else if(e=e.replace(/^[\s\uFEFF\xA0]+/,"")){var t=/[\s\uFEFF\xA0]/,r=e.length,i=r%8;e:{for(;i--;)if(!t.test(e.charAt(--r)))break e;for(;r;){if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e;if(!t.test(e.charAt(--r)))break e}}e=e.substring(0,r+1)}return e},e.repeat=function(e,t){switch(e instanceof Array&&"array"||typeof e){case"string":var r=e;return Array(t+1).join(r);case"array":var i=e.length;if(300>t){var n=Array(t);this.duff(-t,function(t){return n[t]=e[t%i]})}else{for(var n=e.slice();2*n.length<=t;)n=n.concat(n);n=n.concat(n.slice(0,t-n.length))}return n}},e.fire=function(e,t,r,i){return void 0===t&&(t=window),void 0===r&&(r=[]),"function"==typeof e?i?setTimeout(function(){e.apply(t||window,r)},0):e.apply(t||window,r):e},e.duff=function(e,t){if(0>e){for(var r=-e,i=r%8;i--;)t(--r);for(;r;)t(--r),t(--r),t(--r),t(--r),t(--r),t(--r),t(--r),t(--r)}else{for(var n=e,r=0,i=n%8,o=n/8^0;i--;)t(r++);for(;o--;)t(r++),t(r++),t(r++),t(r++),t(r++),t(r++),t(r++),t(r++)}},e.duffEx=function(e,t){if(0>e){var r=-e,i=r%8;e:{for(;i--;)if(!1===t(--r))break e;for(;r;){if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e;if(!1===t(--r))break e}}}else{var n=e,r=0,i=n%8,o=n/8^0;e:{for(;i--;)if(!1===t(r++))break e;for(;o--;){if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e;if(!1===t(r++))break e}}}},e.normalizeUrl=function(e,t){void 0===t&&(t=!0);var r;return r=this.trim(e),r=/^([^:\/?#]+):\/\/[^\/?#.]+\.[^\/?#]+/i.test(r)?r:function(e,t){return t.href=e,t.href}(r,document.createElement("a")),r=encodeURI(decodeURI(r)),r=r.replace(/["`^|\\<>{}\[\]\s].*/,""),r=t?this.justifyPercentEncodingUrlCase_(e,r):r},e.canonicalizeUrl=function(e){function t(e){return e.toUpperCase()}var r=this.normalizeUrl(e,!1);return r=r.replace(/(?:%\w{2})+/g,t)},e.compareUrl=function(e,t){return e=this.canonicalizeUrl(e),t=this.canonicalizeUrl(t),e===t},e.justifyPercentEncodingUrlCase_=function(e,t){function r(t){var r=~e.indexOf(t.toUpperCase())||~e.indexOf(t.toLowerCase());return r?e.substr(~r,t.length):t}return e===t?t:t.replace(/(?:%\w{2})+/g,r)},e}();e.Utility=t}(t=e.LIBRARY||(e.LIBRARY={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r=function(){function r(r){this.model_=r,this.data_=new t.DATA.Main,this.stores_=this.data_.DB.stores,this.util_=e.LIBRARY.Utility}return r.prototype.getCookie=function(e){return this.data_.Cookie.getCookie(e)},r.prototype.setCookie=function(e,t,r){return this.data_.Cookie.setCookie(e,t,r)},r.prototype.connect=function(e){e.database.active?(this.data_.DB.configure(e.database.revision,e.database.refresh),this.data_.DB.up(),this.saveTitle(),this.saveScrollPosition()):this.data_.DB.down()},r.prototype.loadBuffers=function(){for(var e in this.stores_)this.stores_[e].loadBuffer()},r.prototype.saveBuffers=function(){for(var e in this.stores_)this.stores_[e].saveBuffer()},r.prototype.getHistoryBuffer=function(e){return this.stores_.history.getBuffer(this.model_.convertUrlToKey(e,!0))},r.prototype.loadTitle=function(){var e=this,t=this.model_.convertUrlToKey(window.location.href,!0),r=this.stores_.history.getBuffer(t);r&&"string"==typeof r.title?document.title=r.title:this.stores_.history.get(t,function(i){r=i.target.result,r&&r.title&&e.model_.compareKeyByUrl(t,e.util_.canonicalizeUrl(window.location.href))&&(document.title=r.title)})},r.prototype.saveTitle=function(e,t){void 0===e&&(e=window.location.href),void 0===t&&(t=document.title);var r=this.model_.convertUrlToKey(e,!0),i={url:r,title:t,date:(new Date).getTime(),scrollX:undefined,scrollY:undefined,host:undefined,expires:undefined};this.stores_.history.set(i,!0),this.stores_.history.clean()},r.prototype.loadScrollPosition=function(){function e(e,t){"number"==typeof e&&"number"==typeof t&&window.scrollTo(parseInt(Number(e)+"",10),parseInt(Number(t)+"",10))}var t=this,r=this.model_.convertUrlToKey(window.location.href,!0),i=this.stores_.history.getBuffer(r);i&&"number"==typeof i.scrollX?e(i.scrollX,i.scrollY):this.stores_.history.get(r,function(n){i=n.target.result,i&&"number"==typeof i.scrollX&&t.model_.compareKeyByUrl(r,t.util_.canonicalizeUrl(window.location.href))&&e(i.scrollX,i.scrollY)})},r.prototype.saveScrollPosition=function(e,t,r){void 0===e&&(e=window.location.href),void 0===t&&(t=jQuery(window).scrollLeft()),void 0===r&&(r=jQuery(window).scrollTop());var i=this.model_.convertUrlToKey(e,!0),n={url:i,scrollX:t,scrollY:r,date:(new Date).getTime(),title:undefined,host:undefined,expires:undefined};this.stores_.history.set(n,!0)},r.prototype.loadExpires=function(){},r.prototype.saveExpires=function(e,t,r){var i=this.model_.convertUrlToKey(e,!0),n={url:i,host:t||"",expires:r,title:undefined,scrollX:undefined,scrollY:undefined,date:undefined};this.stores_.history.set(n,!0)},r.prototype.getServerBuffers=function(){return this.stores_.server.getBuffers()},r.prototype.getServerBuffer=function(e){var t=this.model_.convertUrlToKey(e,!0).split("//").pop().split("/").shift();return t=this.model_.compareKeyByUrl("http://"+t,"http://"+window.location.host)?"":t,this.stores_.server.getBuffer(t)},r.prototype.loadServer=function(){},r.prototype.saveServer=function(e,t,r,i,n){e=e.split("//").pop().split("/").shift(),e=this.model_.compareKeyByUrl("http://"+e,"http://"+window.location.host)?"":e;var o={host:e,time:Math.max(r,1),score:i,state:n,
expires:t};this.stores_.server.set(o,!0),this.stores_.server.clean()},r.prototype.removeServer=function(e){this.stores_.server.remove(e),this.stores_.server.clean()},r}();t.Data=r}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(t){this.data_=t,this.util_=e.LIBRARY.Utility,this.force_=!1,this._host="",this.parallel_=4}return t.prototype.host_=function(e,t){return t&&(this._host=t.balance.active?this.sanitize(e,t).split("//").pop().split("/").shift()||"":""),this._host},t.prototype.host=function(){return this.host_()},t.prototype.sanitize=function(e,t){if(!t)return"";var r;switch(e&&typeof e){case"string":r=e;break;case"object":var i=e;r=4===i.readyState&&i.getResponseHeader(t.balance.server.header)||i.host}return r=r||"",!/[\/?#"`^|\\<>{}\[\]\s]/.test(r)&&jQuery.grep(t.balance.bounds,function(e){return""===r||"*"===e||r===e||"."===e.charAt(0)&&e===r.slice(-e.length)}).length&&r||""},t.prototype.enable=function(e){return e.balance.active&&e.balance.client.support.browser.test(window.navigator.userAgent)?(this.data_.setCookie(e.balance.client.cookie.balance,"1"),void(e.balance.client.support.redirect.test(window.navigator.userAgent)&&this.data_.setCookie(e.balance.client.cookie.redirect,"1"))):void this.disable(e)},t.prototype.disable=function(e){this.data_.getCookie(e.balance.client.cookie.balance)&&this.data_.setCookie(e.balance.client.cookie.balance,"0"),this.data_.getCookie(e.balance.client.cookie.redirect)&&this.data_.setCookie(e.balance.client.cookie.redirect,"0"),this.changeServer("",e)},t.prototype.score=function(e,t){return Math.max(Math.round(t/e*1e3),0)},t.prototype.changeServer=function(e,t){return t.balance.active?(this.host_(e,t),this.data_.setCookie(t.balance.client.cookie.host,e)):this.host_("",t),this.host()},t.prototype.chooseServers_=function(e){function t(e,t){return+t-+e}var r=this,i=e.balance.server.respite,n=e.balance.weight,o=e.ajax.timeout,a=e.balance.client.hosts.slice();a=this.force_?jQuery.grep(a,function(e){return!!e}):a,function(){var t=r.data_.getCookie(e.balance.client.cookie.host);(!r.force_||t)&&(t===r.sanitize(t,e)?!~jQuery.inArray(t,a)&&a.unshift(t):r.data_.setCookie(e.balance.client.cookie.host,""))}();var s=this.data_.getServerBuffers(),c={};jQuery.each(Object.keys(s),function(t,i){var n=s[i];~jQuery.inArray(n.host,a)&&a.splice(jQuery.inArray(n.host,a),1),(!r.force_||n.host)&&(n.host===r.sanitize(n.host,e)&&n.expires>(new Date).getTime()?c[n.score]=n:r.data_.removeServer(n.host))});var u,h=Object.keys(c).sort(t),l=[];for(jQuery.each(h,function(t){var s=c[h[t]],f=s.host,d=s.time,p=s.score,_=s.state;if(~jQuery.inArray(f,a)&&a.splice(jQuery.inArray(f,a),1),!(_+i>=(new Date).getTime())){switch(_&&r.data_.removeServer(s.host),!0){case l.length>=e.balance.random&&0<l.length:return!1;case n&&!f&&!!Math.floor(Math.random()*n):case o&&d>=o:case l.length>=Math.min(Math.floor(h.length/2),3)&&u&&d>=u.time+500&&o&&d>=2*o/3:case l.length>=Math.min(Math.floor(h.length/2),3)&&u&&p<=u.score/2:return}u=u||s,l.push(f)}});a.length;)l.push(a.splice(Math.floor(Math.random()*a.length),1).shift());return l},t.prototype.chooseServerFromCache_=function(e){var t=this,r=[],i=this.data_.getHistoryBuffer(e.destLocation.href);switch(!0){case!i:break;case i.host!==this.sanitize(i.host,e):this.data_.saveExpires(i.url,"",0);case!i.expires:case i.expires<(new Date).getTime():case this.force_&&!i.host:break;default:r=jQuery.map(this.data_.getServerBuffers(),function(e){return e.host===i.host?e.state>=(new Date).getTime()?void t.data_.saveExpires(i.url,i.host,0):e.host:void 0})}return r.length?r.pop()||" ":""},t.prototype.chooseServerFromScore_=function(e){var t=this.chooseServers_(e);return t.slice(Math.floor(Math.random()*Math.min(t.length,6))).shift()||" "},t.prototype.chooseServer=function(e){return e.balance.active?this.util_.trim(this.chooseServerFromCache_(e)||this.chooseServerFromScore_(e)):""},t.prototype.bypass=function(e){var t=this;this.force_=!0;var r=jQuery.Deferred();if(!e||!e.balance.active)return r.reject();var i=this.parallel_,n=this.chooseServers_(e),o=jQuery.extend({},e.ajax,e.balance.option.ajax);n=jQuery.grep(n,function(e){return!!e});for(var a=0,s=n.length,c=function(i){var u=t,h=(new Date).getTime();"pending"===r.state()&&jQuery.ajax(jQuery.extend({},o,{url:u.util_.normalizeUrl(window.location.protocol+"//"+i+window.location.pathname.replace(/^\/?/,"/")+window.location.search),xhr:e.balance.option.callbacks.ajax.xhr?function(){var t;return t=u.util_.fire(e.balance.option.callbacks.ajax.xhr,this,[event,e]),t="object"==typeof t?t:jQuery.ajaxSettings.xhr()}:undefined,beforeSend:e.balance.option.callbacks.ajax.beforeSend||e.server.header?function(t,r){e.server.header&&t.setRequestHeader(e.nss.requestHeader,"true"),"object"==typeof e.server.header&&(t.setRequestHeader(e.nss.requestHeader,"true"),e.server.header.area&&t.setRequestHeader(e.nss.requestHeader+"-Area",this.app_.chooseArea(e.area,document,document)),e.server.header.head&&t.setRequestHeader(e.nss.requestHeader+"-Head",e.load.head),e.server.header.css&&t.setRequestHeader(e.nss.requestHeader+"-CSS",e.load.css.toString()),e.server.header.script&&t.setRequestHeader(e.nss.requestHeader+"-Script",e.load.script.toString())),u.util_.fire(e.balance.option.callbacks.ajax.beforeSend,this,[event,e,t,r])}:undefined,dataFilter:e.balance.option.callbacks.ajax.dataFilter?function(t,r){return u.util_.fire(e.balance.option.callbacks.ajax.dataFilter,this,[event,e,t,r])||t}:undefined,success:function(t,r,n){h=(new Date).getTime()-h;var o=u.data_.getServerBuffer(this.url),a=u.score(h,n.responseText.length);h=o&&!o.state&&o.time?Math.round((o.time+h)/2):h,a=o&&!o.state&&o.score?Math.round((o.score+a)/2):a,u.data_.saveServer(i,(new Date).getTime()+e.balance.server.expires,h,a,0),i=u.sanitize(n,e)||i,u.util_.fire(e.balance.option.ajax.success,this,arguments)},error:function(t){u.data_.saveServer(i,(new Date).getTime()+e.balance.server.expires,0,0,(new Date).getTime()),i=null,u.util_.fire(e.balance.option.ajax.error,this,arguments)},complete:function(){u.util_.fire(e.balance.option.ajax.complete,this,arguments),++a,r.notify(a,s,i),i?(u.host_(i,e),n.splice(0,n.length),r.resolve(i)):!u.host()&&n.length?c(n.shift()):r.reject()}}))};i--&&n.length;)c(n.shift());return r},t}();t.Balancer=r}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t,i,n,o,a){this.data_=e?{url:e,data:t,textStatus:i,jqXHR:n,host:o,bind:a}:{url:undefined,data:undefined,textStatus:undefined,jqXHR:undefined,host:undefined,bind:undefined},this.data=new r(this.data_)}return e.prototype.state=function(e){var t=e?e.cache.expires.min:undefined,r=e?e.cache.expires.max:undefined;switch(!1){case this.data.jqXHR()&&200===+this.data.jqXHR().status:case this.data.expires(t,r)>=(new Date).getTime():return!1;default:return!0}},e}();e.PageRecord=t;var r=function(){function e(e){this.data_=e}return e.prototype.url=function(){return this.data_.url},e.prototype.data=function(){return this.data_.data},e.prototype.textStatus=function(){return this.data_.textStatus},e.prototype.jqXHR=function(){return this.data_.jqXHR},e.prototype.bind=function(){return this.data_.bind},e.prototype.host=function(){return this.data_.host},e.prototype.expires=function(e,t){if(!this.jqXHR()&&!this.data())return 0;var r,i=this.jqXHR();switch(i&&(i.timeStamp=i.timeStamp||new Date(i.getResponseHeader("Date")).getTime()||(new Date).getTime()),!0){case!i:r=0;break;case/no-store|no-cache/.test(i.getResponseHeader("Cache-Control")):r=0;break;case!!i.getResponseHeader("Cache-Control")&&!!~i.getResponseHeader("Cache-Control").indexOf("max-age="):r=new Date(i.getResponseHeader("Date")||new Date(i.timeStamp).toString()).getTime()+1e3*+i.getResponseHeader("Cache-Control").match(/max-age=(\d*)/).pop();break;case!!i.getResponseHeader("Expires"):r=new Date(i.getResponseHeader("Expires")).getTime();break;default:r=0}return(undefined!==e||undefined!==t)&&(r="number"==typeof e?Math.max(e+(new Date).getTime(),r):r,r="number"==typeof t?Math.min(t+(new Date).getTime(),r):r),r=Math.max(r,0)||0},e}();e.PageRecordData=r}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.chooseArea=function(e,t,r,i){void 0===i&&(i=!0);var n="string"==typeof e?[e]:e;e:for(var o=0;o<n.length;o++){for(var a=n[o],s=a.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[a],c=s.length;c--;){var u=s[c];switch(!0){case 0===jQuery(u,t).length:case jQuery(u,t).length!==jQuery(u,r).length:continue e}}return a}return""},e.prototype.dispatchEvent=function(e,t,r,i){var n=document.createEvent("HTMLEvents");n.initEvent(t,r,i),e.dispatchEvent(n)},e}();e.PageUtility=t}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(t,r,i,n,o,a,s){this.model_=t,this.page_=r,this.balancer_=i,this.setting_=n,this.event_=o,this.success_=a,this.failure_=s,this.util_=e.LIBRARY.Utility,this.binds_=[],this.jsons_=[],this.main_()}return t.prototype.main_=function(){function t(e,t,r){return n.call(this,[].slice.call(arguments),undefined)}function r(e,t,r){return o.apply(this,arguments)}function i(e,t){return a.apply(this,arguments)}function n(e,t,r){void 0===r&&(r=[]),arguments.length&&arguments[0]&&(s.data_=e[0],s.textStatus_=e[1],s.jqXHR_=e[2],s.binds_=r.every(function(e){return!!e&&"object"==typeof e})?r:[r[2]],s.util_.fire(c.callbacks.ajax.success,this[0]||this,[u,c,s.data_,s.textStatus_,s.jqXHR_]))}function o(e,t,r){arguments.length&&arguments[0]&&(s.jqXHR_=e,s.textStatus_=t,s.errorThrown_=r,s.binds_=[],s.util_.fire(c.callbacks.ajax.error,this[0]||this,[u,c,s.jqXHR_,s.textStatus_,s.errorThrown_]))}function a(){arguments.length&&arguments[0]&&(s.util_.fire(c.callbacks.ajax.complete,this[0]||this,[u,c,s.jqXHR_,s.textStatus_]),s.model_.setPageXHR(null),s.model_.setDataXHR(null),200===+s.jqXHR_.status&&s.binds_.every(function(e){return 200===+e.status})?(s.binds_.forEach(function(e,t){return s.binds_[t].responseJSON=s.binds_[t].responseJSON||s.jsons_[t]}),s.model_.setCache(c.destLocation.href,d&&d.data||null,s.textStatus_,s.jqXHR_),s.success_(c,u,s.data_,s.textStatus_,s.jqXHR_,s.host_,s.binds_)):s.failure_(c,u,s.data_,s.textStatus_,s.jqXHR_,s.host_,s.binds_))}var s=this,c=this.setting_,u=this.event_=jQuery.extend(!0,{},this.event_),h=this.util_.fire(c.wait,c,[u,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]),l=c.speedcheck,f=this.model_.speed;l&&(f.fire=u.timeStamp),l&&f.time.splice(0,100,0),l&&f.name.splice(0,100,"pjax("+f.time.slice(-1)+")");var d;switch(c.cache[u.type.toLowerCase()]&&u.type.toLowerCase()){case e.EVENT.CLICK:d=this.model_.getCache(c.destLocation.href);break;case e.EVENT.SUBMIT:d=c.cache[u.currentTarget.method.toLowerCase()]?this.model_.getCache(c.destLocation.href):d;break;case e.EVENT.POPSTATE:d=this.model_.getCache(c.destLocation.href)}var p=this.model_.getPageXHR();if(!(p&&p.readyState<4&&p.location&&this.model_.comparePageByUrl(p.location.href,c.destLocation.href)))if(this.dispatchEvent(document,c.nss.event.pjax.fetch,!1,!1),d&&d.jqXHR&&200===+d.jqXHR.status)if(l&&f.name.splice(0,1,"cache("+f.time.slice(-1)+")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(c.bind,c,[u,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]))),p=d.jqXHR,p.location=p.location||c.destLocation.cloneNode(),this.model_.setPageXHR(p),this.page_.loadtime=0,this.host_=this.balancer_.sanitize(d.host,c),this.data_=d.jqXHR.responseText,this.textStatus_=d.textStatus,this.jqXHR_=d.jqXHR,this.model_.isDeferrable){var _=this.wait_(h);this.page_.setWait(_),jQuery.when(jQuery.Deferred().resolve(this.data_,this.textStatus_,this.jqXHR_),_,jQuery.when.apply(null,this.model_.getDataXHR())).done(n).fail(o).always(a)}else{var y=jQuery.extend({},jQuery.ajaxSettings,c.ajax);y=y.context||y,t.call(y,this.data_,this.textStatus_,this.jqXHR_),i.call(y,this.jqXHR_,this.textStatus_)}else if(p&&p.follow&&!~"error abort timeout parsererror".indexOf(p.statusText)){l&&f.time.splice(0,1,p.timeStamp-f.fire),l&&f.name.splice(0,1,"preload("+f.time.slice(-1)+")"),l&&f.time.push(f.now()-f.fire),l&&f.name.push("continue("+f.time.slice(-1)+")"),this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(c.bind,c,[u,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()]))),p.location=c.destLocation.cloneNode(),this.model_.setPageXHR(p),this.host_=this.model_.host(),this.page_.loadtime=p.timeStamp;var _=this.wait_(h);this.page_.setWait(_),delete p.timeStamp,jQuery.when(p,_,jQuery.when.apply(null,this.model_.getDataXHR())).done(n).fail(o).always(a)}else{this.page_.loadtime=u.timeStamp;var v={};this.host_=this.model_.host(),this.model_.setDataXHR(this.bind_(this.util_.fire(c.bind,c,[u,c,c.origLocation.cloneNode(),c.destLocation.cloneNode()])));var m=this.balance_(c.destLocation.href);switch(v.url=c.server.query?[m.protocol,"//",m.host,m.pathname.replace(/^\/?/,"/"),m.search.replace(/&*$/,"&"+c.server.query).replace(/^\??&/,"?").replace(/(\?|&)$/,""),m.hash].join(""):m.href,u.type.toLowerCase()){case e.EVENT.CLICK:v.type="GET";break;case e.EVENT.SUBMIT:switch(v.type=u.currentTarget.method.toUpperCase(),v.type){case"POST":jQuery(u.currentTarget).has(":file").length?"function"==typeof FormData&&(v.data=(new FormData)(u.currentTarget),v.contentType=!1,v.processData=!1):v.data=jQuery(u.currentTarget).serializeArray();break;case"GET":}break;case e.EVENT.POPSTATE:v.type="GET"}if(v=jQuery.extend({},c.ajax,v,{xhr:c.callbacks.ajax.xhr?function(){var e;return e=s.util_.fire(c.callbacks.ajax.xhr,this,[u,c]),e="object"==typeof e?e:jQuery.ajaxSettings.xhr()}:undefined,beforeSend:c.callbacks.ajax.beforeSend||c.server.header?function(e,t){c.server.header&&e.setRequestHeader(c.nss.requestHeader,"true"),"object"==typeof c.server.header&&(e.setRequestHeader(c.nss.requestHeader,"true"),c.server.header.area&&e.setRequestHeader(c.nss.requestHeader+"-Area",this.app_.chooseArea(c.area,document,document)),c.server.header.head&&e.setRequestHeader(c.nss.requestHeader+"-Head",c.load.head),c.server.header.css&&e.setRequestHeader(c.nss.requestHeader+"-CSS",c.load.css.toString()),c.server.header.script&&e.setRequestHeader(c.nss.requestHeader+"-Script",c.load.script.toString())),s.util_.fire(c.callbacks.ajax.beforeSend,this,[u,c,e,t])}:undefined,dataFilter:c.callbacks.ajax.dataFilter?function(e,t){return s.util_.fire(c.callbacks.ajax.dataFilter,this,[u,c,e,t])||e}:undefined,success:this.model_.isDeferrable?null:t,error:this.model_.isDeferrable?null:r,complete:this.model_.isDeferrable?null:i}),p=jQuery.ajax(v),p.location=c.destLocation.cloneNode(),this.model_.setPageXHR(p),!this.model_.isDeferrable)return;var _=this.wait_(h);this.page_.setWait(_),jQuery.when(this.model_.getPageXHR(),_,jQuery.when.apply(null,this.model_.getDataXHR())).done(n).fail(o).always(a)}},t.prototype.balance_=function(e){var t=(this.setting_,document.createElement("a"));return t.href=e,t.host=this.host_||t.host,t},t.prototype.bind_=function(e){var t=this;return(e||[]).map(function(e){return e.url=t.util_.canonicalizeUrl(e.url),e.url.indexOf("//")>-1?e:(e.url=t.balance_(e.url).href,e)}).map(jQuery.ajax).map(function(e,r){return e.done(function(e,i,n){var o=e;switch(n.getResponseHeader("Content-Type").split("/").pop()){case"json":if(n.responseJSON)break;if(t.jsons_[r])for(var a in o)t.jsons_[r][a]=o[a];else t.jsons_[r]=o}})})},t.prototype.wait_=function(e){var t=jQuery.Deferred();return e?(setTimeout(function(){t.resolve()},e),t):t.resolve()},t.prototype.chooseArea=function(e,t,r){},t.prototype.dispatchEvent=function(e,t,r,i){},t}();t.PageFetch=r}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(t,r,i,n){this.Record_=t,this.model_=r,this.balancer_=i,this.page_=n,this.hash_=function(e){return e.nss.url},this.table_={},this.order_=[],this.fetch_=e.PageFetch}return t.prototype.fetchRecord=function(e,t,r,i){this.getRecord(e).state(e)?this.pullRecord(e,t,r,i):this.pullRecord(e,t,r,i)},t.prototype.pullRecord=function(e,t,r,i){var n=this;new this.fetch_(this.model_,this.page_,this.balancer_,e,t,function(e,t,i,o,a,s,c){var u=n.setRecord(e,n.getRecord(e).data.data()||"",o,a,s,c);r(u,e,t)},function(e,t,r,o,a,s,c){var u=n.setRecord(e,n.getRecord(e).data.data()||"",o,a,s,c);i(u,e,t)})},t.prototype.getRecord=function(e){return this.table_[this.hash_(e)]=this.table_[this.hash_(e)]||new this.Record_},t.prototype.setRecord=function(e,t,r,i,n,o){return this.cleanRecords_(e),this.addOrder_(e),this.table_[this.hash_(e)]=new this.Record_(e.nss.url,t,r,i,n,o)},t.prototype.removeRecord=function(e){return this.removeOrder_(e),this.table_[this.hash_(e)]=new this.Record_},t.prototype.clearRecord=function(){this.order_.splice(0,this.order_.length);for(var e in this.table_)delete this.table_[e]},t.prototype.cleanRecords_=function(e){if(e.cache.limit)for(;this.order_.length>=e.cache.limit;)this.removeRecord(this.order_.pop())},t.prototype.addOrder_=function(e){this.removeOrder_(e),this.order_.unshift(e)},t.prototype.removeOrder_=function(e){for(var t=this.order_.length;t--;)this.order_[t].nss.url===e.nss.url&&this.order_.splice(t,1)},t}();e.PageProvider=t}(t=e.APP||(e.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(t,r,i,n,o,a,s){this.model_=t,this.page_=r,this.data_=i,this.balancer_=n,this.setting_=o,this.event_=a,this.record_=s,this.util_=e.LIBRARY.Utility,this.loadwaits_=[],this.main_()}return t.prototype.main_=function(){var t=this.record_,r=this.setting_,i=this.event_,n=r.speedcheck,o=this.model_.speed;if(n&&o.time.push(o.now()-o.fire),n&&o.name.push("fetch("+o.time.slice(-1)+")"),++this.page_.count,this.page_.loadtime=this.page_.loadtime&&(new Date).getTime()-this.page_.loadtime,r.cache.mix&&e.EVENT.POPSTATE!==i.type.toLowerCase()&&(new Date).getTime()-i.timeStamp<=r.cache.mix)return this.model_.fallback(i);try{if(this.page_.landing=null,!~(t.data.jqXHR().getResponseHeader("Content-Type")||"").toLowerCase().search(r.contentType))throw new Error("throw: content-type mismatch");if(this.srcTitle_=jQuery(t.data.jqXHR().responseText.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i).pop()).text(),this.dstTitle_=document.title,this.redirect_(),this.dispatchEvent(window,r.nss.event.pjax.unload,!1,!1),this.url_(),!this.model_.comparePageByUrl(r.destLocation.href,window.location.href))throw new Error("throw: location mismatch");this.document_()}catch(a){if(!a)return;this.model_.getCache(window.location.href)&&this.model_.removeCache(r.destLocation.href),this.model_.fallback(i)}},t.prototype.isRegister_=function(t,r){if(t.destLocation.href===t.origLocation.href)return!1;switch(r.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:return!0;case e.EVENT.POPSTATE:return!1}},t.prototype.isReplace_=function(t,r){switch(r.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:return jQuery(r.currentTarget).is(t.replace);case e.EVENT.POPSTATE:return!1}},t.prototype.isCacheUsable_=function(t,r){switch(!0){case!r.cache.click&&!r.cache.submit&&!r.cache.popstate:case e.EVENT.SUBMIT===t.type.toLowerCase()&&!r.cache[t.currentTarget.method.toLowerCase()]:return!1;default:return!0}},t.prototype.redirect_=function(){var t=this,r=this.setting_,i=this.event_,n=(jQuery('head meta[http-equiv="Refresh"][content*="URL="]').attr("content")||"").match(/\w+:\/\/[^;\s"']+|$/i).shift();if(n&&!this.model_.comparePageByUrl(r.destLocation.href,n)){var o=r.destLocation.cloneNode();if(o.href=n,this.util_.fire(r.callbacks.update.redirect.before,r,[i,r,o.cloneNode(),r.origLocation.cloneNode(),r.destLocation.cloneNode()])!==!1){switch(!0){case!r.redirect:case o.protocol!==r.destLocation.protocol:case o.host!==r.destLocation.host:case e.EVENT.SUBMIT===i.type.toLowerCase()&&"GET"!==i.currentTarget.method.toUpperCase():switch(i.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:window.location.assign(o.href);break;case e.EVENT.POPSTATE:window.location.replace(o.href)}throw!1;default:switch(jQuery[e.DEF.NAME].enable(),i.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:setTimeout(function(){return jQuery[e.DEF.NAME].click(o.href)},0);break;case e.EVENT.POPSTATE:window.history.replaceState(window.history.state,this.srcTitle_,o.href),this.isRegister_(r,i)&&r.fix.location&&!this.util_.compareUrl(r.destLocation.href,window.location.href)&&(jQuery[e.DEF.NAME].disable(),window.history.back(),window.history.forward(),jQuery[e.DEF.NAME].enable()),setTimeout(function(){return t.dispatchEvent(window,e.EVENT.POPSTATE,!1,!1)},0)}throw!1}this.util_.fire(r.callbacks.update.redirect.after,r,[i,r,o.cloneNode(),r.origLocation.cloneNode(),r.destLocation.cloneNode()])===!1}}},t.prototype.url_=function(){var t=this.setting_,r=this.event_;this.model_.location.href=t.destLocation.href,this.util_.fire(t.callbacks.update.url.before,t,[r,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()])!==!1&&(this.isReplace_(t,r)?(window.history.replaceState(this.util_.fire(t.state,t,[r,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]),this.srcTitle_,t.destLocation.href),t.fix.location&&!this.util_.compareUrl(t.destLocation.href,window.location.href)&&window.location.replace(t.destLocation.href)):this.isRegister_(t,r)&&(window.history.pushState(this.util_.fire(t.state,t,[r,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]),~window.navigator.userAgent.toLowerCase().indexOf("opera")?this.dstTitle_:this.srcTitle_,t.destLocation.href),t.fix.location&&!this.util_.compareUrl(t.destLocation.href,window.location.href)&&(jQuery[e.DEF.NAME].disable(),window.history.back(),window.history.forward(),jQuery[e.DEF.NAME].enable())),this.util_.fire(t.callbacks.update.url.after,t,[r,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()])===!1)},t.prototype.document_=function(){var t=this,r=this.setting_,i=this.event_;if(r.load.script&&!this.page_.loadedScripts[""]){var n=this.page_.loadedScripts;n[""]=!0,jQuery("script").each(function(){var e=this;e.src&&(n[e.src]=!r.load.reload||!jQuery(e).is(r.load.reload))})}this.srcDocument_=this.page_.parser.parse(this.record_.data.jqXHR().responseText,r.destLocation.href),this.dstDocument_=document;var o=r.speedcheck,a=this.model_.speed;if(o&&a.time.push(a.now()-a.fire),o&&a.name.push("parse("+a.time.slice(-1)+")"),this.area_=this.chooseArea(r.area,this.srcDocument_,this.dstDocument_),!this.area_)throw new Error("throw: area notfound");this.areas_=this.area_.match(/(?:[^,]+?|\(.*?\)|\[.*?\])+/g),this.overwriteDocumentByCache_(),r.fix.noscript&&this.escapeNoscript_(this.srcDocument_),r.fix.reference&&this.fixReference_(r.origLocation.href,this.dstDocument_),this.rewrite_(),this.title_(),r.fix.history&&this.data_.saveTitle(),this.data_.saveExpires(this.record_.data.url(),this.record_.data.host(),this.record_.data.expires()),this.head_(),o&&a.time.push(a.now()-a.fire),o&&a.name.push("head("+a.time.slice(-1)+")"),this.content_(),o&&a.time.push(a.now()-a.fire),o&&a.name.push("content("+a.time.slice(-1)+")"),this.balance_(),this.css_('link[rel~="stylesheet"], style'),jQuery(window).one(e.DEF.NAME+":rendering",function(n){n.preventDefault(),n.stopImmediatePropagation();var s=function(e){return t.model_.comparePageByUrl(r.destLocation.href,window.location.href)?(t.dispatchEvent(document,r.nss.event.pjax.ready,!1,!1),jQuery(t.area_).each(function(e,t){return jQuery(t).width()}),jQuery.when?jQuery.Deferred().resolve():e()):void 0},c=function(n){return t.model_.comparePageByUrl(r.destLocation.href,window.location.href)?(t.util_.fire(r.callback,r,[i,r]),setTimeout(function(){switch(i.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:t.model_.overlay(r)||t.scrollByHash_(r)||t.scroll_(!0);break;case e.EVENT.POPSTATE:t.model_.overlay(r)||t.scroll_(!0)}},100),t.dispatchEvent(document,r.nss.event.pjax.render,!1,!1),o&&a.time.push(a.now()-a.fire),o&&a.name.push("render("+a.time.slice(-1)+")"),jQuery.when?jQuery.when.apply(jQuery,t.loadwaits_):n()):void 0},u=function(){return t.model_.comparePageByUrl(r.destLocation.href,window.location.href)?(t.dispatchEvent(window,r.nss.event.pjax.load,!1,!1),o&&a.time.push(a.now()-a.fire),o&&a.name.push("load("+a.time.slice(-1)+")"),o&&console.log(a.time),o&&console.log(a.name),t.script_("[src][defer]"),jQuery.when&&jQuery.Deferred().resolve()):jQuery.when&&jQuery.Deferred().reject()};if(t.scroll_(!1),100>t.page_.loadtime&&r.reset.type.match(i.type.toLowerCase())&&!jQuery('form[method][method!="GET"]').length)switch(!1){case t.page_.count<r.reset.count||!r.reset.count:case(new Date).getTime()<r.reset.time+t.page_.time||!r.reset.time:throw new Error("throw: reset")}var h=t.script_(":not([defer]), :not([src])");if(jQuery.when){var l=jQuery.Deferred().pipe?"pipe":"then";jQuery.when.apply(jQuery,h)[l](function(){return s()})[l](function(){return c()})[l](function(){return u()})}else s(function(){return c(function(){return u()})})}).trigger(e.DEF.NAME+":rendering")},t.prototype.overwriteDocumentByCache_=function(){var e=this.setting_,t=this.event_,r=this.model_.getCache(e.destLocation.href);if(this.isCacheUsable_(t,e)&&r&&r.data){var i=e.fix.noscript?this.restoreNoscript_(r.data):r.data,n=this.page_.parser.parse(i,e.destLocation.href),o=this.srcDocument_;o.title=n.title;for(var a,s,c=0;this.areas_[c];c++){if(a=jQuery(this.areas_[c],n).clone(),s=jQuery(this.areas_[c],o),!a.length||!s.length||a.length!==s.length)throw new Error("throw: area mismatch");for(var u=0;a[u];u++)s[u].parentNode.replaceChild(a[u],s[u])}}},t.prototype.rewrite_=function(){function e(e){if(!e)return{};switch(e.getResponseHeader("Content-Type").split("/").pop()){case"json":return e.responseJSON}}var t=this.setting_,r=this.event_;t.rewrite&&this.util_.fire(t.callbacks.update.rewrite.before,t,[r,t,this.srcDocument_,this.dstDocument_])!==!1&&(this.util_.fire(t.rewrite,t,[this.srcDocument_,this.area_,this.record_.data.host(),this.record_.data.bind().map(e)]),this.util_.fire(t.callbacks.update.rewrite.before,t,[r,t,this.srcDocument_,this.dstDocument_])===!1)},t.prototype.title_=function(){var e=this.setting_,t=this.event_;this.util_.fire(e.callbacks.update.title.before,e,[t,e,this.srcDocument_.title,this.dstDocument_.title])!==!1&&(this.dstDocument_.title=this.srcDocument_.title,this.util_.fire(e.callbacks.update.title.after,e,[t,e,this.srcDocument_.title,this.dstDocument_.title])===!1)},t.prototype.head_=function(){var e=this.setting_,t=this.event_,r=this.srcDocument_,i=this.dstDocument_;if(e.load.head&&this.util_.fire(e.callbacks.update.head.before,e,[t,e,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])!==!1){for(var n,o="base, meta, link",a=jQuery(r.head).children(o).filter(e.load.head).not(e.load.ignore).not('link[rel~="stylesheet"], style, script'),s=jQuery(i.head).children(o).filter(e.load.head).not(e.load.ignore).not('link[rel~="stylesheet"], style, script'),c=jQuery(),u=s,h=0;n=a[h];h++){for(var l=0;u[l];l++)if(u[l].tagName===n.tagName&&u[l].outerHTML===n.outerHTML){if(c.length){var f=s[s.index(u[l])-1];f?jQuery(f).after(c.clone()):u.eq(l).before(c.clone()),c=jQuery()}u=u.not(u[l]),n=null;break}c=c.add(n)}jQuery("title",i).before(c.clone()),u.remove(),this.util_.fire(e.callbacks.update.head.after,e,[t,e,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])===!1}},t.prototype.content_=function(){function e(){if(jQuery.Deferred){var e=jQuery.Deferred();switch(this.tagName.toLowerCase()){case"img":jQuery(this).one("load error abort",e.resolve);break;case"iframe":case"frame":jQuery(this).one("load",e.resolve)}return e}}var t=this,r=this.setting_,i=this.event_,n=this.srcDocument_,o=this.dstDocument_;if(this.util_.fire(r.callbacks.update.content.before,r,[i,r,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])!==!1){jQuery(this.area_).children("."+r.nss.elem+"-check").remove();for(var a,s,c=0;this.areas_[c];c++){if(a=jQuery(this.areas_[c],n),s=jQuery(this.areas_[c],o),!a.length||!s.length||a.length!==s.length)throw new Error("throw: area mismatch");a=a.map(function(e,t){return document.importNode(t,!0)}),a.find("script").each(function(e,r){return t.escapeScript_(r)}),this.loadwaits_=this.loadwaits_.concat(a.find("img, iframe, frame").map(e).get());for(var u=0;a[u];u++)s[u].parentNode.replaceChild(a[u],s[u]),document.body===a[u]&&(jQuery.each(a[u].attributes,function(e,t){return s[u].removeAttribute(t.name)}),jQuery.each(a[u].attributes,function(e,t){return s[u].setAttribute(t.name,t.value)}));s=jQuery(this.areas_[c],o),s.find("script").each(function(e,r){return t.restoreScript_(r)})}this.dispatchEvent(document,r.nss.event.pjax.DOMContentLoaded,!1,!1),this.util_.fire(r.callbacks.update.content.after,r,[i,r,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])===!1}},t.prototype.balance_=function(){var e=this,t=this.setting_,r=this.event_;!t.balance.active||this.page_.loadtime<100||[this.record_.data.jqXHR()].concat(this.record_.data.bind()).forEach(function(i){var n=e.balancer_.sanitize(i,t)||e.record_.data.host()||"",o=e.page_.loadtime,a=e.balancer_.score(o,i.responseText.length);if(e.util_.fire(t.callbacks.update.balance.before,t,[r,t,n,e.page_.loadtime,i.responseText.length])!==!1){var s=e.data_.getServerBuffer(t.destLocation.href),a=e.balancer_.score(o,i.responseText.length);o=s&&!s.state&&s.time?Math.round((s.time+o)/2):o,a=s&&!s.state&&s.score?Math.round((s.score+a)/2):a,e.data_.saveServer(n,(new Date).getTime()+t.balance.server.expires,o,a,0),e.balancer_.changeServer(e.balancer_.chooseServer(t),t),e.util_.fire(t.callbacks.update.balance.after,t,[r,t,n,e.page_.loadtime,i.responseText.length])===!1}})},t.prototype.css_=function(e){function t(){return jQuery.contains(o.head,this)}function r(){return jQuery.contains(o.body,this)}var i=this.setting_,n=this.event_,o=this.srcDocument_,a=this.dstDocument_;if(i.load.css){var s="link, style",c=jQuery(s,o).filter(e).not(jQuery("noscript",o).find(s)),u=jQuery(s,a).filter(e).not(jQuery("noscript",o).find(s)),h=jQuery(),l=u;if(this.util_.fire(i.callbacks.update.css.before,i,[n,i,c.get(),u.get()])!==!1){c=c.not(i.load.ignore),u=c.not(i.load.ignore);for(var f,d=0;f=c[d];d++){for(var p,_=0;l[_];_++){switch(f.tagName.toLowerCase()){case"link":p=f.href===l[_].href;break;case"style":p=this.util_.trim(f.innerHTML)===this.util_.trim(l[_].innerHTML)}if(p){if(h.length){if(jQuery.contains(a.body,l[_])&&h.first().parents("head").length)jQuery(a.head).append(h.filter(t).clone()),l.eq(_).before(h.filter(r).clone());else{var y=u[u.index(l[_])-1];y?jQuery(y).after(h.clone()):l.eq(_).before(h.clone())}h=jQuery()}l=l.not(l[_]),_-=Number(!!_),f=null;break}}h=h.add(f)}if(jQuery(a.head).append(h.filter(t).clone()),jQuery(a.body).append(h.filter(r).clone()),l.remove(),u=jQuery(s,a).filter(e).not(jQuery("noscript",o).find(s)),this.util_.fire(i.callbacks.update.css.after,i,[n,i,c.get(),u.get()])!==!1){var v=i.speedcheck,m=this.model_.speed;v&&m.time.push(m.now()-m.fire),v&&m.name.push("css("+m.time.slice(-1)+")")}}}},t.prototype.script_=function(e){var t=this,r=this.setting_,i=this.event_,n=this.srcDocument_,o=this.dstDocument_,a=[],s=[];if(!r.load.script)return a;var c="script",u=jQuery(c,n).filter(e).not(jQuery("noscript",n).find(c)),h=jQuery(c,o).filter(e).not(jQuery("noscript",o).find(c)),l=this.page_.loadedScripts,f=/^$|(?:application|text)\/(?:java|ecma)script/i,d=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;if(this.util_.fire(r.callbacks.update.script.before,r,[i,r,u.get(),h.get()])===!1)return a;u=u.not(r.load.ignore);for(var p,_=function(e,i){if(!t.model_.comparePageByUrl(r.destLocation.href,window.location.href))return!1;e.src&&(l[e.src]=!r.load.reload||!jQuery(e).is(r.load.reload));
try{if(t.model_.isDeferrable){if("string"!=typeof i)throw i;eval.call(window,i)}else e.hasAttribute("src")?jQuery.ajax(jQuery.extend(!0,{},r.ajax,r.load.ajax,{url:e.src,dataType:"script",async:!1,global:!1,success:function(){return null},error:function(e){throw e}})):eval.call(window,(e.text||e.textContent||e.innerHTML||"").replace(d,""));try{e.hasAttribute("src")&&t.dispatchEvent(e,"load",!1,!1)}catch(n){}}catch(o){try{e.hasAttribute("src")&&t.dispatchEvent(e,"error",!1,!1)}catch(n){}if(!0===r.load.error)throw o;t.util_.fire(r.load.error,r,[o,e])}},y=0;p=u[y];y++)if(f.test(p.type||"")&&(p.hasAttribute("src")?!l[p.src]:this.util_.trim(p.innerHTML))){var v=jQuery(p).parent(r.load.log)[0];if(v&&!jQuery(p).parents(this.area_).length){var m=jQuery(v.id||v.tagName,o)[0],g=p.cloneNode(!0);this.escapeScript_(g),m.appendChild(g),this.restoreScript_(g)}!function(e){var i=t.model_.isDeferrable&&jQuery.Deferred();e.hasAttribute("src")&&e.getAttribute("src")?(l[e.src]=!r.load.reload||!jQuery(e).is(r.load.reload),e.hasAttribute("async")?jQuery.ajax(jQuery.extend({},r.ajax,r.load.ajax,{url:e.src,dataType:"script",async:!0,global:!1,success:function(){return t.dispatchEvent(e,"load",!1,!1)},error:function(){return t.dispatchEvent(e,"error",!1,!1)}})):i?(jQuery.ajax(jQuery.extend({},r.ajax,r.load.ajax,{url:e.src,dataType:"text",async:!0,global:!1,success:function(t){return i.resolve([e,t])},error:function(t){return i.resolve([e,t])}})),a.push(i)):s.push(e)):e.hasAttribute("src")||(i?a.push(i.resolve([e,(e.text||e.textContent||e.innerHTML||"").replace(d,"")])):s.push(e))}(p)}try{this.model_.isDeferrable?jQuery.when.apply(jQuery,a).always(function(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];return jQuery.each(e,function(e,r){return _.apply(t,r)})}):jQuery.each(s,function(e,t){return _(t)})}catch(E){throw setTimeout(function(){return t.model_.fallback(i)},1),E}if(h=jQuery(c,o).filter(e).not(jQuery("noscript",o).find(c)),this.util_.fire(r.callbacks.update.script.after,r,[i,r,u.get(),h.get()])===!1)return a;var b=r.speedcheck,w=this.model_.speed;return b&&w.time.push(w.now()-w.fire),b&&w.name.push("script("+w.time.slice(-1)+")"),a},t.prototype.scroll_=function(t){var r=this.setting_,i=this.event_;if(this.util_.fire(r.callbacks.update.scroll.before,r,[i,r])!==!1){var n,o;switch(i.type.toLowerCase()){case e.EVENT.CLICK:case e.EVENT.SUBMIT:n=t&&"function"==typeof r.scrollLeft?this.util_.fire(r.scrollLeft,r,[i,r,r.origLocation.cloneNode(),r.destLocation.cloneNode()]):r.scrollLeft,n=n>=0?n:0,n=n===!1||null===n?jQuery(window).scrollLeft():parseInt(Number(n)+"",10),o=t&&"function"==typeof r.scrollTop?this.util_.fire(r.scrollTop,r,[i,r,r.origLocation.cloneNode(),r.destLocation.cloneNode()]):r.scrollTop,o=o>=0?o:0,o=o===!1||null===o?jQuery(window).scrollTop():parseInt(Number(o)+"",10),window.scrollTo(n,o);break;case e.EVENT.POPSTATE:t&&r.fix.scroll&&this.data_.loadScrollPosition()}t&&this.data_.saveScrollPosition(),this.util_.fire(r.callbacks.update.scroll.after,r,[i,r])===!1}},t.prototype.scrollByHash_=function(e){var t=e.destLocation.hash.replace(/^#/,"");if(!t)return!1;var r=jQuery("#"+t+", [name~="+t+"]").first();return r.length?(isFinite(r.offset().top)&&window.scrollTo(jQuery(window).scrollLeft(),parseInt(Number(r.offset().top)+"",10)),this.data_.saveScrollPosition(),!0):!1},t.prototype.fixReference_=function(e,t){function r(e,t){var r;switch(!0){case"href"in t:r="href";break;case"src"in t:r="src";break;default:return}switch(i){case 0:break;case 1:t[r]=u+t.getAttribute(r);break;case-1:t[r]=t.getAttribute(r).replace(u,"")}t.setAttribute(r,t[r].replace(c,"/"))}var i,n=e.replace(/[^\/]+$/,""),o=t.URL.replace(/[^\/]+$/,""),a=n.split("/").length,s=o.split("/").length,c=/^.+?\w\//,u=this.util_.repeat("../",Math.abs(a-s));switch(!0){case a===s:i=0;break;case s>a:i=1;break;case a>s:i=-1}jQuery("[href], [src]",t).not(['[href^="/"]','[href^= "http:"]','[href^= "https:"]','[src^= "/"]','[src^= "http:"]','[src^= "https:"]'].join(",")).each(r)},t.prototype.escapeNoscript_=function(e){function t(){jQuery(this).text(this.innerHTML)}jQuery("noscript",e).children().parent().each(t)},t.prototype.restoreNoscript_=function(e){var t=jQuery("<span/>");return e.replace(/(<noscript>)([^<>]+?)(<\/noscript>)/gim,function(e,r,i,n){return r+t.html(i).text()+n})},t.prototype.escapeScript_=function(e){jQuery.data(e,"source",e.src),jQuery.data(e,"code",e.innerHTML),e.removeAttribute("src"),e.innerHTML=""},t.prototype.restoreScript_=function(e){undefined!==jQuery.data(e,"code")&&(e.innerHTML=" ",jQuery.data(e,"source")?(e.src=jQuery.data(e,"source"),jQuery.removeData(e,"source")):e.removeAttribute("src"),e.innerHTML=jQuery.data(e,"code"),jQuery.removeData(e,"code"))},t.prototype.chooseArea=function(e,t,r){},t.prototype.dispatchEvent=function(e,t,r,i){},t}();t.PageUpdate=r}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){var r=function(){function t(){this.util_=e.LIBRARY.Utility,this.sandbox_cache_={}}return t.prototype.sandbox_=function(e){var t=this;return void 0===e&&(e=window.location.href),e=this.util_.canonicalizeUrl(e).split("#").shift(),this.sandbox_cache_[e]&&"object"==typeof this.sandbox_cache_[e].document&&this.sandbox_cache_[e].document.URL===e||jQuery('<iframe srcdoc="<!DOCTYPE html>" sandbox="allow-same-origin"></iframe>').appendTo("body").each(function(r,i){t.sandbox_cache_[e]=i.contentWindow,t.sandbox_cache_[e].document.open(),t.sandbox_cache_[e].document.close()}).remove(),this.sandbox_cache_[e]},t.prototype.test_=function(e){try{var t='<html lang="en" class="html"><head><title>&amp;</title><link href="/"><noscript><style>/**/</style></noscript></head><body><noscript>noscript</noscript><a href="/"></a></body></html>',r=this.parse(t,window.location.href,e);switch(!1){case!!r:case r.URL&&decodeURI(r.URL)===decodeURI(window.location.href):case"&"===r.title:case!!r.querySelector('html.html[lang="en"]'):case!!r.querySelector("head>link").href:case!!r.querySelector("head>noscript").innerHTML:case!!r.querySelector("body>noscript").innerHTML:case!!r.querySelector("body>a").href:throw!0}return e}catch(i){}},t.prototype.parse=function(e,t,r){function i(e,t){var r=document.createElement("div");r.innerHTML=t.match(/<html(?:\s.*?[^\\])?>|$/i).shift().replace(/html/i,"div")||"<div>";for(var i,n=r.firstChild.attributes,o=0;i=n[o];o++)e.documentElement.setAttribute(i.name,i.value);var r=document.createElement("html");for(r.innerHTML=t.replace(/^.*?<html(?:\s.*?[^\\])?>/im,""),e.documentElement.removeChild(e.head),e.documentElement.removeChild(e.body);r.childNodes.length;)e.documentElement.appendChild(r.childNodes[0]);return e}void 0===t&&(t=""),void 0===r&&(r=this.mode_),e+=~e.search(/<title[\s>]/i)?"":"<title></title>";var n;switch(r){case"dom":n=(new window.DOMParser).parseFromString(e,"text/html");break;case"doc":if(n=document.implementation.createHTMLDocument(""),"object"!=typeof n.activeElement||!n.activeElement)break;"function"==typeof window.DOMParser&&(n.title=(new window.DOMParser).parseFromString(e.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i),"text/html").title),n.open(),n.write(e),n.close(),n.title!==n.querySelector("title").textContent&&(n.title=n.querySelector("title").textContent);break;case"manipulate":n=i(document.implementation.createHTMLDocument(""),e);break;case null:n=null;break;default:switch(/webkit|firefox|trident|$/i.exec(window.navigator.userAgent).shift().toLowerCase()){case"webkit":this.mode_=this.test_("doc")||this.test_("dom")||this.test_("manipulate");break;case"firefox":this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate");break;case"trident":this.mode_=this.test_("manipulate")||this.test_("dom")||this.test_("doc");break;default:this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate")}n=this.mode_&&this.parse(e,t)}return n},t}();t.PageParser=r;var i=function(){function e(){e.instance_=e.instance_||new r}return e.prototype.singleton_=function(){return e.instance_},e.prototype.parse=function(e,t){return this.singleton_().parse(e,t)},e}();t.PageParserSingleton=i}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r;!function(t){e.MIXIN(t.PageFetch,[t.PageUtility]),e.MIXIN(t.PageUpdate,[t.PageUtility]);var r=function(){function r(r,i,n){var o=this;this.model_=r,this.data_=i,this.balancer_=n,this.util_=e.LIBRARY.Utility,this.parser=new t.PageParserSingleton,this.provider=new t.PageProvider(t.PageRecord,this.model_,this.balancer_,this),this.landing=this.util_.normalizeUrl(window.location.href),this.loadedScripts={},this.dataXHR=[],this.loadtime=0,this.count=0,this.time=(new Date).getTime(),setTimeout(function(){return o.parser.parse("")||o.model_.disable()},100)}return r.prototype.transfer=function(t,r){switch(r.type.toLowerCase()){case e.EVENT.CLICK:this.data_.saveTitle(),this.data_.saveScrollPosition();break;case e.EVENT.SUBMIT:this.data_.saveTitle(),this.data_.saveScrollPosition();break;case e.EVENT.POPSTATE:this.data_.saveTitle(t.origLocation.href,document.title),t.fix.history&&this.data_.loadTitle()}t=jQuery.extend(!0,{},t),t.origLocation=t.origLocation.cloneNode(),t.destLocation=t.destLocation.cloneNode(),t=e.FREEZE(t),this.fetch_(t,r)},r.prototype.getWait=function(){return this.wait_},r.prototype.setWait=function(e){return this.wait_&&this.wait_.state&&"pending"===this.wait_.state()&&this.wait_.reject(),this.wait_=e},r.prototype.fetch_=function(e,t){var r=this;this.provider.fetchRecord(e,t,function(e,t,i){return r.success_(e,t,i)},function(e,t,i){return r.failure_(e,t,i)})},r.prototype.success_=function(e,r,i){new t.PageUpdate(this.model_,this,this.data_,this.balancer_,r,i,e)},r.prototype.failure_=function(e,t,r){var i=this;t.fallback&&"abort"!==e.data.textStatus()&&(this.data_.saveExpires(t.destLocation.href,"",0),t.balance.active&&(this.data_.saveServer(e.data.host(),(new Date).getTime()+t.balance.server.expires,0,0,(new Date).getTime()),this.balancer_.changeServer(this.balancer_.chooseServer(t),t)),setTimeout(function(){return i.model_.fallback(r)},100))},r.prototype.chooseArea=function(e,t,r){},r.prototype.dispatchEvent=function(e,t,r,i){},r}();t.Page=r}(r=t.APP||(t.APP={}))}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(MODULE){var MODEL;!function(MODEL){var APP;!function(APP){MODULE.MIXIN(APP.Page,[APP.PageUtility]);var Main=function(){function Main(e,t){this.model_=e,this.controller_=t,this.util_=MODULE.LIBRARY.Utility,this.settings_={},this.data=new APP.Data(this.model_),this.balancer=new APP.Balancer(this.data),this.page=new APP.Page(this.model_,this.data,this.balancer)}return Main.prototype.initialize=function(e,t){var r=this;this.controller_.view(e,t),this.balancer.enable(t),this.balancer.changeServer(this.balancer.chooseServer(t),t),this.data.loadBuffers(),setTimeout(function(){return r.page.landing=null},1500)},Main.prototype.configure=function(destination){var _this=this,event=destination.preventDefault?destination:null;switch(event&&"object"==typeof event&&event.type.toLowerCase()){case MODULE.EVENT.CLICK:return this.configure(event.currentTarget);case MODULE.EVENT.SUBMIT:return this.configure(event.currentTarget);case MODULE.EVENT.POPSTATE:return this.configure(window.location);case null:}var url;switch(!0){case"string"==typeof destination:url=destination;break;case"href"in destination&&"string"==typeof destination.href:url=this.util_.normalizeUrl(destination.href);break;case"href"in destination&&"object"==typeof destination.href:url=this.util_.normalizeUrl(destination.href.baseVal);break;case"action"in destination:switch(url=this.util_.normalizeUrl(destination.action.replace(/[?#].*/,"")),destination.method.toUpperCase()){case"GET":url+="?"+jQuery(destination).serialize()}break;default:url=this.model_.location.href,this.option_=destination}var index=[this.util_.canonicalizeUrl(this.model_.location.href).slice(0,2048),this.util_.canonicalizeUrl(url).slice(0,2048)].join(" ");if(!this.option_)return null;if(index in this.settings_)return this.settings_[index];var origLocation=this.model_.location.cloneNode(),destLocation=this.model_.location.cloneNode();origLocation.href=this.util_.canonicalizeUrl(origLocation.href),destLocation.href=this.util_.canonicalizeUrl(url);var scope=this.scope_(this.option_,origLocation.href,destLocation.href)||null,initial={area:"body",link:"a:not([target])",filter:function(){var e=document.createElement("a");return e.href="string"==typeof this.href?this.href:this.href.baseVal,/^https?:/.test(e.href)&&/\/[^.]*$|\.(html?|php)$/.test(e.pathname.replace(/^\/?/,"/"))},form:null,replace:null,bind:null,rewrite:null,scope:null,state:null,scrollTop:0,scrollLeft:0,ajax:{dataType:"text"},contentType:"text/html",redirect:!0,cache:{click:!1,submit:!1,popstate:!1,get:!0,post:!0,mix:0,limit:100,expires:{max:null,min:3e5}},buffer:{limit:30,delay:500},load:{head:"",css:!1,script:!1,ignore:'[src*="jquery.js"], [src*="jquery.min.js"], [href^="chrome-extension://"]',reload:"",log:"head, body",error:!0,ajax:{dataType:"script",cache:!0}},balance:{active:!1,bounds:["*"],weight:1,random:0,option:{server:{header:!1},ajax:{crossDomain:!0},callbacks:{ajax:{beforeSend:null}}},client:{hosts:[],support:{browser:/msie|trident.+ rv:|chrome|firefox|safari/i,redirect:/chrome|firefox|safari/i},cookie:{balance:"balanceable",redirect:"redirectable",host:"host"}},server:{header:"X-Ajax-Host",respite:6e5,expires:864e6}},wait:0,fallback:!0,reset:{type:"",count:100,time:108e5},fix:{location:!0,history:!0,scroll:!0,noscript:!0,reference:!0},database:{active:!0,revision:0,refresh:10},server:{query:null,header:!0},overlay:"",callback:null,callbacks:{ajax:{},update:{redirect:{},url:{},rewrite:{},title:{},head:{},content:{},scroll:{},css:{},script:{},balance:{}}},data:undefined},force={uid:MODULE.UUID(),ns:"",nss:undefined,speedcheck:undefined,origLocation:origLocation,destLocation:destLocation,scroll:{queue:[]},option:this.option_},compute=function(){setting.ns=setting.ns?setting.ns.split(".").sort().join("."):"";var nsArray=[MODULE.DEF.NAME].concat(setting.ns?setting.ns.split("."):[]),query=setting.server.query;switch(query&&typeof query){case"string":query=eval("({"+query.toString().match(/[^?=&]+=[^&]*/g).join("&").replace(/"/g,'\\"').replace(/([^?=&]+)=([^&]*)/g,'"$1": "$2"').replace(/&/g,",")+"})");case"object":query=jQuery.param(query);break;default:query=""}return{uid:undefined,ns:undefined,origLocation:undefined,destLocation:undefined,scroll:undefined,option:undefined,speedcheck:undefined,nss:{array:nsArray,name:nsArray.join("."),data:nsArray[0],url:_this.model_.convertUrlToKey(setting.destLocation.href,!0),event:{pjax:{fetch:[MODULE.EVENT.PJAX,"fetch"].join(":"),unload:[MODULE.EVENT.PJAX,"unload"].join(":"),DOMContentLoaded:[MODULE.EVENT.PJAX,"DOMContentLoaded"].join(":"),ready:[MODULE.EVENT.PJAX,"ready"].join(":"),render:[MODULE.EVENT.PJAX,"render"].join(":"),load:[MODULE.EVENT.PJAX,"load"].join(":")},click:[MODULE.EVENT.CLICK].concat(nsArray.join(":")).join("."),submit:[MODULE.EVENT.SUBMIT].concat(nsArray.join(":")).join("."),popstate:[MODULE.EVENT.POPSTATE].concat(nsArray.join(":")).join("."),scroll:[MODULE.EVENT.SCROLL].concat(nsArray.join(":")).join(".")},elem:nsArray.join("-"),requestHeader:["X",nsArray[0].replace(/^\w/,function(e){return e.toUpperCase()})].join("-")},fix:/android|iphone os|like mac os x/i.test(window.navigator.userAgent)?undefined:{location:!1},contentType:setting.contentType.replace(/\s*[,;]\s*/g,"|").toLowerCase(),database:{refresh:Math.min(setting.database.refresh,30)},reset:{type:(setting.reset.type||"").toLowerCase()},server:{query:query},timeStamp:(new Date).getTime()}},setting;return setting=jQuery.extend(!0,initial,scope||this.option_),setting=jQuery.extend(!0,setting,setting.balance.active&&setting.balance.option,force),setting=jQuery.extend(!0,setting,compute()),scope?(MODULE.FREEZE(setting,!0),this.settings_[index]=setting,setting):(this.settings_[index]=null,null)},Main.prototype.scope_=function(e,t,r){if(e=jQuery.extend(!0,{},e),!e.scope)return e;var i,n,o,a,s,c,u=e.scope;i=this.model_.convertUrlToKey(t,!0).match(/.+?\w(\/.*)/).pop(),n=this.model_.convertUrlToKey(r,!0).match(/.+?\w(\/.*)/).pop(),o=i.split("/");for(var h=o.length;h--;)if(a=o.slice(0,h+1).join("/"),a+="/"===i.charAt(a.length)?"/":"",a&&a in u){var l;if(u[a]instanceof Array?(s="",l=u[a]):(s=u[a],l=u[s]),l){l=l.concat();var f,d,p,_=[];p=c=f=d=undefined;for(var y,v=0;y=l[v];v++){if("#"===y.charAt(0)){if(~jQuery.inArray(y,_)||!(y.length>1)){s="";continue}_.push(y),s=y.slice(1),[].splice.apply(l,[v,1].concat(u[s],"#")),y=l[v]}if("inherit"===y)p=!0;else if("string"==typeof y){var m="!"===y.charAt(0);y=m?y.slice(1):y;var g="*"===y.charAt(0);y=g?y.slice(1):y,(g?~i.search(y):~i.indexOf(y))&&(m?f=!1:(f=!0,c=u["$"+s]||u["$"+y]||undefined)),(g?~n.search(y):~n.indexOf(y))&&(m?d=!1:(d=!0,c=u["$"+s]||u["$"+y]||undefined))}if(!1===f||!1===d)return null}if(f&&d)return jQuery.extend(!0,e,c);if(!p)break}}return undefined},Main}();APP.Main=Main}(APP=MODEL.APP||(MODEL.APP={}))}(MODEL=MODULE.MODEL||(MODULE.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(e){e.App=e.APP.Main}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){var t;!function(t){var r=function(r){function i(){r.call(this,e.State.initiate),this.controller_=new e.Controller(this).singleton(),this.app_=new t.App(this,this.controller_),this.util_=e.LIBRARY.Utility,this.isDeferrable=!!jQuery.when&&"1.006"<=jQuery().jquery.match(/\d[\d.]+\d/).pop().replace(/\.(\d+)/g,".00$1").replace(/0*(\d{3})/g,"$1"),this.location=document.createElement("a"),this.queue_=[]}return __extends(i,r),i.prototype.host=function(){return this.app_.balancer.host()},i.prototype.state=function(){return this.state_},i.prototype.main_=function(t,r){var i=this;switch(typeof r){case"object":t=t instanceof e.DEF.NAMESPACE?t:jQuery(document)[e.DEF.NAME](),e.FREEZE(r,!0);break;default:return t}if(!window.history||!window.history.pushState||!window.history.replaceState)return t;this.location.href=this.util_.normalizeUrl(window.location.href);var n=this.app_.configure(r);return n?(this.app_.data.connect(n),this.speed={fire:0,time:[],name:[],now:function(){return(new Date).getTime()}},jQuery(function(){i.app_.initialize(t,n),i.state_=i.state()===e.State.initiate?e.State.open:i.state(),i.overlay(n,!0)}),t):t},i.prototype.convertUrlToKey=function(e,t){return e=t?this.util_.canonicalizeUrl(e):e,this.util_.trim(e).split("#").shift()},i.prototype.compareKeyByUrl=function(e,t){return e=this.convertUrlToKey(e,!0),t=this.convertUrlToKey(t,!0),e===t},i.prototype.comparePageByUrl=function(e,t){return e=this.convertUrlToKey(e,!0),t=this.convertUrlToKey(t,!0),e===t},i.prototype.configure=function(e){return this.app_.configure(e)},i.prototype.isOperatable=function(t){if(e.State.open!==this.state())return!1;if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)return!1;var r;switch(t.type.toLowerCase()){case e.EVENT.CLICK:if(r=this.app_.configure(t.currentTarget),r&&!jQuery(t.currentTarget).filter(r.filter).length)return!1;break;case e.EVENT.SUBMIT:r=this.app_.configure(t.currentTarget);break;case e.EVENT.POPSTATE:r=this.app_.configure(window.location)}if(!r)return!1;if(r.origLocation.protocol!==r.destLocation.protocol||r.origLocation.host!==r.destLocation.host)return!1;switch(t.type.toLowerCase()){case e.EVENT.CLICK:if(this.comparePageByUrl(r.origLocation.href,r.destLocation.href)&&r.destLocation.hash)return!1;break;case e.EVENT.SUBMIT:break;case e.EVENT.POPSTATE:if(this.comparePageByUrl(r.origLocation.href,r.destLocation.href))return!1}return this.app_.page.chooseArea(r.area,document,document)?!0:!1},i.prototype.getPageXHR=function(){return this.app_.page.pageXHR},i.prototype.setPageXHR=function(e){return this.app_.page.pageXHR&&this.app_.page.pageXHR.readyState<4&&this.app_.page.pageXHR!==e&&this.app_.page.pageXHR.abort(),this.app_.page.pageXHR=e},i.prototype.getDataXHR=function(){return this.app_.page.dataXHR},i.prototype.setDataXHR=function(e){function t(t){switch(!0){case t>=r.length:case 4===r[t].readyState:case r.indexOf(e[t])>-1:return e[t]}return r[t].abort(),e[t]}e=e||[];var r=this.app_.page.dataXHR;return this.app_.page.dataXHR=Array.apply(null,Array(Math.max(e.length,this.app_.page.dataXHR.length))).map(function(e,r){return t(r)}).filter(function(e){return!!e})},i.prototype.click=function(t){t.timeStamp=(new Date).getTime();var r=t.currentTarget,i=(jQuery(r),this.app_.configure(r));switch(this.location.href=this.util_.normalizeUrl(window.location.href),!0){case!i:case t.isDefaultPrevented():case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(i,t),t.preventDefault();break;case this.isHashChange(i)&&this.overlay(i):t.preventDefault(),window.history.pushState(null,document.title,i.destLocation.href);break;case!t.originalEvent&&!jQuery(document).has(r).length:this.fallback(t)}},i.prototype.submit=function(t){t.timeStamp=(new Date).getTime();var r=t.currentTarget,i=(jQuery(r),this.app_.configure(r));switch(this.location.href=this.util_.normalizeUrl(window.location.href),!0){case!i:case t.isDefaultPrevented():case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(i,t),t.preventDefault;break;case!t.originalEvent&&!jQuery(document).has(r).length:this.fallback(t)}},i.prototype.popstate=function(t){if(!this.app_.page.landing||!this.util_.compareUrl(this.app_.page.landing,window.location.href)){t.timeStamp=(new Date).getTime();var r=this.app_.configure(window.location);switch(!0){case!r:!this.comparePageByUrl(this.location.href,window.location.href)&&this.fallback(t);break;case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(r,t);break;case this.isHashChange(r)&&this.overlay(r):break;case!this.comparePageByUrl(r.origLocation.href,window.location.href):this.fallback(t)}this.location.href=this.util_.normalizeUrl(window.location.href)}},i.prototype.scroll=function(e,t){for(var r,i=this;r=this.queue_.shift();)clearTimeout(r);r=setTimeout(function(){for(;r=i.queue_.shift();)clearTimeout(r);i.compareKeyByUrl(window.location.href,i.location.href)&&i.app_.data.saveScrollPosition()},300),this.queue_.push(r)},i.prototype.fallback=function(e){var t=this.configure(e);switch(!0){case t&&!t.fallback:case t&&!1===this.util_.fire(t.fallback,t,[e,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]):break;default:this.movePageNormally_(e)}},i.prototype.movePageNormally_=function(t){switch(t.type.toLowerCase()){case e.EVENT.CLICK:"string"==typeof t.currentTarget.href?window.location.assign(t.currentTarget.href):window.location.assign(t.currentTarget.href.baseVal);break;case e.EVENT.SUBMIT:switch(t.currentTarget.method.toUpperCase()){case"GET":window.location.assign(t.currentTarget.action.replace(/[?#].*/,"")+"?"+jQuery(t.currentTarget).serialize());break;case"POST":window.location.assign(t.currentTarget.action)}break;case e.EVENT.POPSTATE:window.location.reload()}},i.prototype.isHashChange=function(e){return!!e&&e.origLocation.href.replace(/#.*/,"")===e.destLocation.href.replace(/#.*/,"")&&e.origLocation.hash!==e.destLocation.hash},i.prototype.overlay=function(e,t){var r=this,i=e.destLocation.hash.replace(/^#/,"");if(!i||!e.overlay)return!1;var n=jQuery("#"+i+", [name~="+i+"]");if(n=n.add(n.nextUntil(":header")),n=n.filter(e.overlay).add(n.find(e.overlay)).first(),!n.length)return!1;this.isHashChange(e)&&(this.app_.data.loadScrollPosition(),setTimeout(function(){return r.app_.data.loadScrollPosition()},1));var o=jQuery("<div>");return n=n.clone(!0),o.addClass(e.nss.elem+"-overlay").css({background:"rgba(255, 255, 255, 0.8)",display:"none",position:"fixed",top:0,left:0,right:0,bottom:0,margin:0,padding:0,border:"none"}).append(n.css({position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto"}).show()),o.bind("click",o,function(e){e.target===e.currentTarget&&(window.history.pushState(window.history.state,document.title,window.location.href.replace(/#.*/,"")),r.location.href=r.util_.normalizeUrl(window.location.href),jQuery(e.data).fadeOut("fast",function(){return jQuery(e.data).remove()}))}),o.appendTo("body").fadeIn(t?0:100),jQuery(window).one("popstate",o,function(e){setTimeout(function(){return r.app_.data.loadScrollPosition()},1),jQuery(e.data).fadeOut("fast",function(){return jQuery(e.data).remove()})}),/trident/i.test(window.navigator.userAgent)&&n.width(n.width()),this.app_.data.saveScrollPosition(),!0},i.prototype.enable=function(){this.state_=e.State.open},i.prototype.disable=function(){this.state_=e.State.pause},i.prototype.getCache=function(e){var t=this.configure(this.convertUrlToKey(e));if(t){var r=this.app_.page.provider.getRecord(t);return r.state(t)||r.data.data()?{data:r.data.data(),textStatus:r.data.textStatus(),jqXHR:r.data.jqXHR(),expires:r.data.expires(),host:r.data.host()}:void this.removeCache(e)}},i.prototype.setCache=function(e,t,r,i){var n=this.configure(this.convertUrlToKey(e));if(n){var o=this.app_.page.provider.getRecord(n);this.app_.page.provider.setRecord(n,t||"",r||o.data.textStatus(),i||o.data.jqXHR(),this.app_.balancer.sanitize(i,n)||o.data.host()||"",null)}},i.prototype.removeCache=function(e){var t=this.configure(this.convertUrlToKey(e));t&&this.app_.page.provider.removeRecord(t)},i.prototype.clearCache=function(){this.app_.page.provider.clearRecord()},i.prototype.bypass=function(){return this.app_.balancer.bypass(this.app_.configure(window.location))},i}(t.Template);t.Main=r;var i=function(){function e(){e.instance_=e.instance_||new r}return e.singleton=function(){return e.instance_},e.prototype.singleton=function(){return e.singleton()},e}();t.Singleton=i}(t=e.MODEL||(e.MODEL={}))}(MODULE||(MODULE={}));var MODULE;!function(e){e.Model=e.MODEL.Singleton}(MODULE||(MODULE={}));var Module=function(){function e(){new MODULE.Model}return e}();new Module}(window,window.document,void 0,jQuery);